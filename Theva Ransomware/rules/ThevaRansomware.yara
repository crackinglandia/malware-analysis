rule ThevaRansomware {
	meta:
		description = "YARA rule for Theva Ransomware"
		reference = ""
		author = "crackinglandia"

	strings:

		$delete_recovery_mechanisms = {
			6A ?? 6A ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 6A ?? FF D6 6A ?? 6A ?? 68 
			?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 6A ?? FF D6 6A ?? 6A ?? 68 ?? ?? ?? ?? 68 
			?? ?? ?? ?? 68 ?? ?? ?? ?? 6A ?? FF D6 6A ?? 6A ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 
			?? ?? ?? ?? 6A ?? FF D6 E8 ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 8B 40 ?? C7 84 05 ?? ?? ?? 
			?? ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 8B 48 ?? 8D 41 ?? 89 84 0D ?? ?? ?? ?? 8D 8D ?? ?? 
			?? ?? E8 ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 8B 40 ?? C7 84 05 ?? ?? ?? ?? ?? ?? ?? ?? 8B 
			85 ?? ?? ?? ?? 8B 48 ?? 8D 41 ?? 89 84 0D ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? C7 45 ?? ?? 
			?? ?? ?? 50 C7 85 ?? ?? ?? ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 83 C4 ?? 
			8B 40 ?? C7 84 05 ?? ?? ?? ?? ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 8B 48 ?? 8D 41 ?? 89 84 
			0D ?? ?? ?? ?? 8D 8D ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 8B 40 ?? C7 84 05 
			?? ?? ?? ?? ?? ?? ?? ?? 8B 85 ?? ?? ?? ?? 8B 48 ?? 8D 41 ?? 89 84 0D ?? ?? ?? ?? 8D 
			85 ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? 50 C7 85 ?? ?? ?? ?? ?? ?? ?? ?? E8 ?? ?? ?? ?? 
			83 C4
		}

		$get_drives = {
			55 8B EC 83 EC ?? A1 ?? ?? ?? ?? ?? ?? ?? ?? FC 53 56 57 8B D9 FF 15 ?? ?? ?? ?? 33 
			FF 89 45 ?? 33 F6 BA ?? ?? ?? ?? 8B CE D3 E2 85 D0 74 ?? 8D 46 ?? 50 8D 45 ?? 68 ?? 
			?? ?? ?? 50 FF 15 ?? ?? ?? ?? 83 C4 ?? 8D 45 ?? 50 FF 15 ?? ?? ?? ?? 83 FE ?? 7D ?? 
			83 F8 ?? 74 ?? 83 F8 ?? 74 ?? 83 F8 ?? 74 ?? 83 F8 ?? 75 ?? 8D 46 ?? 66 89 04 7B 47 
			8B 45 ?? 46 83 FE ?? 7C ?? 8B 4D ?? 33 C0 66 89 04 7B 33 CD 5F 5E 5B E8 ?? ?? ?? ?? 
			8B E5 5D C3 
		}

		$enum_network_resources = {
			55 8B EC B8 ?? ?? ?? ?? E8 ?? ?? ?? ?? A1 ?? ?? ?? ?? ?? ?? ?? ?? FC 53 56 57 8D 85 
			?? ?? ?? ?? 8B FA 50 51 6A ?? 6A ?? 6A ?? 89 BD ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 8B F0 
			85 F6 74 ?? 56 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? 81 FE ?? ?? ?? ?? 75 ?? 68 ?? 
			?? ?? ?? 8D 85 ?? ?? ?? ?? 50 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 8D 85 ?? ?? ?? ?? 
			50 FF 15 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF B5 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 68 
			?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? B8 ?? ?? ?? ?? 5F 5E 5B 8B 4D ?? 33 CD E8 ?? ?? 
			?? ?? 8B E5 5D C3 8D 85 ?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 50 8D 85 ?? ?? ?? 
			?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 50 8D 85 ?? ?? ?? ?? 50 FF B5 ?? ?? ?? ?? FF 15 ?? 
			?? ?? ?? 8B F0 85 F6 74 ?? 56 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? 81 FE ?? ?? ?? 
			?? 75 ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 8D 
			85 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF B5 ?? ?? ?? ?? 8D 85 ?? 
			?? ?? ?? 50 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? B8 ?? ?? ?? ?? 5F 5E 5B 8B 4D ?? 
			33 CD E8 ?? ?? ?? ?? 8B E5 5D C3 33 DB 39 9D ?? ?? ?? ?? 76 ?? 8D B5 ?? ?? ?? ?? 0F 
			1F 44 00 ?? 85 FF 7E ?? 8B 4E ?? E8 ?? ?? ?? ?? 83 EF ?? 75 ?? 8B BD ?? ?? ?? ?? 68 
			?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? F6 06 ?? 74 ?? 8D 57 ?? 8D 4E ?? E8 ?? ?? ?? ?? 
			43 83 C6 ?? 3B 9D ?? ?? ?? ?? 72 ?? FF B5 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 8B 4D ?? 33 
			C0 5F 5E 33 CD 5B E8 ?? ?? ?? ?? 8B E5 5D C3 
		}

		$search_files = {
			55 8B EC B8 ?? ?? ?? ?? E8 ?? ?? ?? ?? A1 ?? ?? ?? ?? ?? ?? ?? ?? FC 53 56 8B 35 ?? 
			?? ?? ?? 8D 85 ?? ?? ?? ?? 57 8B F9 68 ?? ?? ?? ?? 57 68 ?? ?? ?? ?? 50 89 BD ?? ?? 
			?? ?? FF D6 83 C4 ?? 8D 85 ?? ?? ?? ?? 50 8D 85 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 89 
			85 ?? ?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 8B 1D ?? ?? ?? ?? 66 0F 1F 84 00 ?? ?? 00 00 
			68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF D3 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 
			85 ?? ?? ?? ?? 50 FF D3 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 
			FF D3 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF D3 85 C0 0F 84 
			?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF D3 85 C0 0F 84 ?? ?? ?? ?? 68 ?? 
			?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF D3 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 85 ?? 
			?? ?? ?? 50 FF D3 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF D3 
			85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF D3 85 C0 0F 84 ?? ?? 
			?? ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF D3 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? 
			?? 8D 85 ?? ?? ?? ?? 50 FF D3 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? 
			?? 50 FF D3 85 C0 0F 84 ?? ?? ?? ?? F6 85 ?? ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 57 8D 
			85 ?? ?? ?? ?? 68 ?? ?? ?? ?? 50 74 ?? FF D6 83 C4 ?? 8D 8D ?? ?? ?? ?? BA ?? ?? ?? 
			?? E8 ?? ?? ?? ?? E9 ?? ?? ?? ?? FF D6 33 F6 83 C4 ?? 39 35 ?? ?? ?? ?? 0F 8E ?? ?? 
			?? ?? FF 34 B5 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 50 FF D3 85 C0 0F 
			85 ?? ?? ?? ?? 8B CF E8 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 8D 85 ?? ?? 
			?? ?? 68 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 8B 3D ?? ?? ?? ?? 83 C4 ?? 68 ?? ?? ?? ?? 
			FF 15 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? C7 05 ?? ?? ?? ?? ?? ?? ?? ?? C7 05 
			?? ?? ?? ?? ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 0F 57 C0 8D 95 ?? ?? ?? ?? 57 8D 8D ?? ?? 
			?? ?? 0F 11 05 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? 84 C0 74 ?? 8D 85 ?? ?? ?? ?? 50 
			E8 ?? ?? ?? ?? 83 C4 ?? 8D 85 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 8B BD ?? ?? ?? ?? 46 
			3B 35 ?? ?? ?? ?? 0F 8C ?? ?? ?? ?? 8B 35 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 FF B5 ?? 
			?? ?? ?? FF 15 ?? ?? ?? ?? 85 C0 0F 85 ?? ?? ?? ?? FF B5 ?? ?? ?? ?? FF 15 ?? ?? ?? 
			?? 8B 4D ?? 5F 5E 33 CD 5B E8 ?? ?? ?? ?? 8B E5 5D C3 
		}

		$encrypt_random_value = {
			55 8B EC B8 ?? ?? ?? ?? E8 ?? ?? ?? ?? A1 ?? ?? ?? ?? ?? ?? ?? ?? FC 8B 45 ?? 56 8B 
			75 ?? 57 68 ?? ?? ?? ?? 89 85 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 68 ?? ?? ?? ?? 50 E8 ?? 
			?? ?? ?? 83 C4 ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? C7 85 ?? ?? ?? ?? 
			?? ?? ?? ?? C7 85 ?? ?? ?? ?? ?? ?? ?? ?? 6A ?? 6A ?? 50 8D 85 ?? ?? ?? ?? 50 6A ?? 
			6A ?? 8D 85 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 85 C0 75 ?? FF 15 ?? ?? ?? ?? 50 68 ?? 
			?? ?? ?? 6A ?? E8 ?? ?? ?? ?? 83 C4 ?? 50 E8 ?? ?? ?? ?? 83 C4 ?? 33 C0 5F 5E 8B 4D 
			?? 33 CD E8 ?? ?? ?? ?? 8B E5 5D C2 ?? ?? 8D 85 ?? ?? ?? ?? 50 8D 85 ?? ?? ?? ?? 50 
			6A ?? 68 ?? ?? ?? ?? FF B5 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? 50 6A ?? 6A ?? FF 15 ?? ?? 
			?? ?? 85 C0 75 ?? FF 15 ?? ?? ?? ?? 50 68 ?? ?? ?? ?? EB ?? 8B 3D ?? ?? ?? ?? 8D 85 
			?? ?? ?? ?? 68 ?? ?? ?? ?? 6A ?? 68 ?? ?? ?? ?? 6A ?? 50 FF D7 85 C0 75 ?? 6A ?? 6A 
			?? 68 ?? ?? ?? ?? 50 8D 85 ?? ?? ?? ?? 50 FF D7 85 C0 74 ?? 8D 85 ?? ?? ?? ?? 50 FF 
			B5 ?? ?? ?? ?? 6A ?? FF B5 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 85 C0 75 ?? FF 15 ?? ?? ?? 
			?? 50 68 ?? ?? ?? ?? E9 ?? ?? ?? ?? 8B 46
		}

		$encrypt_files_p1 = {
			55 8B EC 83 EC ?? A1 ?? ?? ?? ?? ?? ?? ?? ?? FC 53 56 57 8B 7D ?? 33 F6 56 68 ?? ?? 
			?? ?? 6A ?? 56 6A ?? 6A ?? 51 89 55 ?? 83 CB ?? C6 45 ?? ?? C7 45 ?? ?? ?? ?? ?? C7 
			45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? C7 45 ?? ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 89 45 
			?? 3B C3 0F 84 ?? ?? ?? ?? 56 68 ?? ?? ?? ?? 6A ?? 56 6A ?? 68 ?? ?? ?? ?? FF 75 ?? 
			FF 15 ?? ?? ?? ?? 8B D8 89 5D ?? 83 FB ?? 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? 6A ?? 56 
			56 8D 45 ?? 50 FF 15 ?? ?? ?? ?? 85 C0 75 ?? 6A ?? 6A ?? 50 50 8D 45 ?? 50 FF 15 ?? 
			?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 85 FF 0F 84 ?? ?? ?? ?? 80 3F ?? 0F 84 ?? ?? ?? ?? 
			81 FF ?? ?? ?? ?? 0F 84 ?? ?? ?? ?? 8D 45 ?? 50 6A ?? 6A ?? 68 ?? ?? ?? ?? FF 75 ?? 
			FF 15 ?? ?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 6A ?? 57 FF 15 ?? ?? ?? ?? 50 57 FF 75 ?? 
			FF 15 ?? ?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 8D 45 ?? 50 6A ?? FF 75 ?? 68 ?? ?? ?? ?? 
			FF 75 ?? FF 15 ?? ?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 8B 3D ?? ?? ?? ?? 6A ?? 68 ?? ?? 
			?? ?? 6A ?? FF 75 ?? FF D7 85 C0 0F 84 ?? ?? ?? ?? 6A ?? 68 ?? ?? ?? ?? 6A ?? FF 75 
			?? FF D7 85 C0 0F 84 ?? ?? ?? ?? 6A ?? 68 ?? ?? ?? ?? 6A ?? FF 75 ?? FF D7 85 C0 0F 
			85 ?? ?? ?? ?? E9 ?? ?? ?? ?? 8B 3D ?? ?? ?? ?? 8D 45 ?? 50 6A ?? 68 ?? ?? ?? ?? FF 
			75 ?? FF D7 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? 8D 45 ?? 
			50 6A ?? FF 75 ?? FF 15 ?? ?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? E8 ?? ?? 
			?? ?? 83 C4 ?? 8D 45 ?? 50 6A ?? 6A ?? 6A ?? FF 75 ?? FF 75 ?? FF 15 ?? ?? ?? ?? 85
			}

		$encrypt_files_p2 = {
			C0 0F 84 ?? ?? ?? ?? FF 75 ?? 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? FF 75 ?? E8 ?? ?? ?? ?? 
			8B F8 83 C4 ?? 85 FF 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? 8D 45 
			?? 50 57 6A ?? 6A ?? FF 75 ?? FF 75 ?? FF 15 ?? ?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 68 
			?? ?? ?? ?? E8 ?? ?? ?? ?? 8B 45 ?? 83 C4 ?? 85 C0 74 ?? 50 FF 15 ?? ?? ?? ?? 85 C0 
			0F 84 ?? ?? ?? ?? 89 75 ?? 6A ?? 8D 45 ?? 50 6A ?? 8D 45 ?? 50 53 FF 15 ?? ?? ?? ?? 
			85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 ?? 8D 45 ?? 6A ?? 50 FF 
			75 ?? 57 53 FF 15 ?? ?? ?? ?? 85 C0 0F 84 ?? ?? ?? ?? 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? 
			83 C4 ?? 57 E8 ?? ?? ?? ?? 83 C4 ?? 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? 8B F0 83 C4 ?? 85 
			F6 74 ?? 8B 7D ?? 32 DB 6A ?? 8D 45 ?? 50 68 ?? ?? ?? ?? 56 FF 75 ?? FF 15 ?? ?? ?? 
			?? 85 C0 74 ?? 81 7D ?? ?? ?? ?? ?? B8 ?? ?? ?? ?? 68 ?? ?? ?? ?? 0F B6 DB 0F 42 D8 
			8D 45 ?? 50 56 6A ?? 0F B6 C3 50 6A ?? FF 75 ?? FF 15 ?? ?? ?? ?? 85 C0 74 ?? 6A ?? 
			8D 45 ?? 50 FF 75 ?? 56 57 FF 15 ?? ?? ?? ?? 85 C0 74 ?? 84 DB 74 ?? C6 45 ?? ?? 8B 
			DF 83 7D ?? ?? 8B 3D ?? ?? ?? ?? 74 ?? 8B 45 ?? 50 FF D7 85 DB 74 ?? 6A ?? E8 ?? ?? 
			?? ?? 83 C4 ?? 50 E8 ?? ?? ?? ?? 83 C4 ?? 6A ?? 6A ?? 68 ?? ?? ?? ?? 53 FF 15 ?? ?? 
			?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? FF 15 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 
			C7 05 ?? ?? ?? ?? ?? ?? ?? ?? C7 05 ?? ?? ?? ?? ?? ?? ?? ?? C7 05 ?? ?? ?? ?? ?? ?? 
			?? ?? FF 15 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 53 FF 15 ?? ?? 
			?? ?? 53 FF D7 
		}

	condition:
		uint16(0) == 0x5a4d and all of them
}